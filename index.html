<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CoinTracker - 비트코인 ETF 비교</title>
    <style>
        /* 기본 스타일 */
        body {
            font-family: 'Noto Sans KR', sans-serif;
            margin: 0;
            background-color: #121826;
            color: #E5ECF6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        a {
            color: #FFB800;
            text-decoration: none;
        }

        /* 헤더 스타일 */
        header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start; /* 상단 정렬 */
            padding: 10px 0;
            border-bottom: 1px solid #2a3f5f;
        }
        .logo-section {
            display: flex;
            flex-direction: column; /* 로고와 시간을 세로로 정렬 */
        }
        .logo {
            font-size: 24px;
            font-weight: bold;
        }
        .timestamp {
            font-size: 12px;
            color: #8c9db3;
            margin-top: 5px;
        }

        .header-metrics {
            display: flex;
            gap: 40px; /* 가격과 유입량 사이의 간격 */
        }
        .live-btc-price, .live-etf-inflow {
            text-align: right;
        }
        .live-btc-price .price, .live-etf-inflow .total {
            font-size: 28px;
            font-weight: bold;
        }
        .live-btc-price .change, .live-etf-inflow .change {
            font-size: 16px;
        }

        /* 공통 상승/하락 색상 */
        .up { color: #4CAF50 !important; }
        .down { color: #F44336 !important; }
        
        /* 메인 대시보드 스타일 */
        .dashboard {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        .main-chart-container, .etf-list-container {
            background-color: #1A2233;
            padding: 20px;
            border-radius: 8px;
        }
        h2 {
            margin-top: 0;
            border-bottom: 1px solid #2a3f5f;
            padding-bottom: 10px;
            font-weight: 500;
        }
        .main-chart-container {
            height: 400px;
        }

        /* ETF 리스트 테이블 스타일 */
        .etf-table {
            width: 100%;
            border-collapse: collapse;
        }
        .etf-table th, .etf-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #2a3f5f;
        }
        .etf-table th {
            font-weight: 500;
        }
        .etf-table tbody tr:hover {
            background-color: #2a3f5f;
        }

        /* 아이콘 버튼 스타일 */
        .icon-button-section {
            margin-top: 20px;
            text-align: center;
        }
        .graph-link-button {
            display: inline-block;
            background-color: #FFB800;
            color: #121826;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        .graph-link-button:hover {
            background-color: #ffd466;
        }
        .graph-link-button .icon {
            margin-right: 10px;
            font-size: 24px;
            vertical-align: middle;
        }

        /* 뉴스 섹션 */
        .news-section {
            background-color: #1A2233;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .news-list {
            padding-left: 0;
        }
        .news-list li {
            padding: 10px 0;
            border-bottom: 1px solid #2a3f5f;
            list-style: none;
        }
        .news-list li:last-child {
            border-bottom: none;
        }
        .news-title {
            font-size: 16px;
        }
        .news-meta {
            font-size: 12px;
            color: #8c9db3;
        }

        /* 푸터 */
        footer {
            text-align: center;
            padding: 20px;
            margin-top: 40px;
            border-top: 1px solid #2a3f5f;
            font-size: 14px;
            color: #8c9db3;
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <div class="logo-section">
                <div class="logo">
                    <a href="#">CoinTracker</a>
                </div>
                <div class="timestamp" id="timestamp-display">
                    Loading time...
                </div>
            </div>
            <div class="header-metrics">
                <div class="live-etf-inflow">
                    <div>Total ETF Net Inflow</div>
                    <div class="total" id="etf-inflow-total">Loading...</div>
                    <div class="change" id="etf-inflow-change"></div>
                </div>
                <div class="live-btc-price">
                    <div>Bitcoin Price</div>
                    <div class="price" id="btc-price">Loading...</div>
                    <div class="change" id="btc-change"></div>
                </div>
            </div>
        </header>

        <main>
            <div class="dashboard">
                <div class="main-chart-container">
                    <div class="tradingview-widget-container" style="height:100%;width:100%">
                      <div id="tradingview_f73f8" style="height:calc(100% - 32px);width:100%"></div>
                      <div class="tradingview-widget-copyright"><a href="https://kr.tradingview.com/" rel="noopener nofollow" target="_blank"><span class="blue-text">TradingView에서 모든 시장 추적</span></a></div>
                      <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
                      <script type="text/javascript">
                      new TradingView.widget(
                      {
                      "autosize": true,
                      "symbol": "BITSTAMP:BTCUSD",
                      "interval": "D",
                      "timezone": "Etc/UTC",
                      "theme": "dark",
                      "style": "1",
                      "locale": "ko",
                      "enable_publishing": false,
                      "allow_symbol_change": true,
                      "container_id": "tradingview_f73f8"
                    }
                      );
                      </script>
                    </div>
                </div>

                <div class="etf-list-container">
                    <h2>주요 현물 ETF</h2>
                    <table class="etf-table">
                        <thead>
                            <tr>
                                <th>티커</th>
                                <th>운용사</th>
                                <th>AUM</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>IBIT</td>
                                <td>BlackRock</td>
                                <td>$19.5B</td>
                            </tr>
                            <tr>
                                <td>FBTC</td>
                                <td>Fidelity</td>
                                <td>$11.2B</td>
                            </tr>
                            <tr>
                                <td>ARKB</td>
                                <td>ARK/21Shares</td>
                                <td>$4.6B</td>
                            </tr>
                            <tr>
                                <td>BITB</td>
                                <td>Bitwise</td>
                                <td>$4.4B</td>
                            </tr>
                             <tr>
                                <td>GBTC</td>
                                <td>Grayscale</td>
                                <td>$28.7B</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="icon-button-section">
                <a href="graph.html" class="graph-link-button" target="_blank">
                    <span class="icon">📊</span> BTC 가격 vs ETF 유입량 상세 분석
                </a>
            </div>

            <div class="news-section">
                <h2>최신 뉴스</h2>
                <ul class="news-list">
                    <li>
                        <div class="news-title"><a href="#">비트코인, 기관 투자자 유입 증가로 7만 달러 돌파 시도</a></div>
                        <div class="news-meta">코인뉴스 · 2시간 전</div>
                    </li>
                    <li>
                        <div class="news-title"><a href="#">미 SEC, 추가 비트코인 현물 ETF 승인 여부 검토 중</a></div>
                        <div class="news-meta">블록체인 투데이 · 5시간 전</div>
                    </li>
                    <li>
                        <div class="news-title"><a href="#">블랙록 IBIT, 출시 6개월 만에 최대 규모 ETF 등극</a></div>
                        <div class="news-meta">월스트리트 저널 · 1일 전</div>
                    </li>
                </ul>
            </div>
        </main>
        
        <footer>
            <p>&copy; 2024 CoinTracker. All rights reserved.</p>
            <p><a href="#">이용약관</a> | <a href="#">개인정보처리방침</a></p>
        </footer>
    </div>
    
    <script>
        // DOM 요소 가져오기
        const btcPriceElement = document.getElementById('btc-price');
        const btcChangeElement = document.getElementById('btc-change');
        const etfTotalElement = document.getElementById('etf-inflow-total');
        const etfChangeElement = document.getElementById('etf-inflow-change');
        const timestampElement = document.getElementById('timestamp-display');
        let lastPrice = 0;
        
        // 1. BTC 가격 가져오기 함수
        async function fetchBtcPrice() {
            try {
                const response = await fetch('https://min-api.cryptocompare.com/data/pricemultifull?fsyms=BTC&tsyms=USD');
                const data = await response.json();
                const priceData = data.RAW.BTC.USD;
                const currentPrice = priceData.PRICE;
                const change24h = priceData.CHANGE24HOUR;
                const changePct24h = priceData.CHANGEPCT24HOUR;

                btcPriceElement.innerText = `$${currentPrice.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
                
                const sign = change24h >= 0 ? '+' : '';
                btcChangeElement.innerText = `${sign}${change24h.toFixed(2)} (${sign}${changePct24h.toFixed(2)}%)`;
                
                btcPriceElement.classList.remove('up', 'down');
                if (currentPrice > lastPrice) btcPriceElement.classList.add('up');
                else if (currentPrice < lastPrice) btcPriceElement.classList.add('down');
                
                btcChangeElement.classList.remove('up', 'down');
                if (change24h >= 0) btcChangeElement.classList.add('up');
                else btcChangeElement.classList.add('down');
                
                lastPrice = currentPrice;
            } catch (error) {
                console.error('Error fetching Bitcoin price:', error);
                btcPriceElement.innerText = 'Error';
            }
        }

        // 2. ETF 총 유입량 표시 함수 (Farside 데이터 기준으로 수정)
        function displayEtfInflow() {
            // Farside 데이터를 기준으로 정확한 수치로 업데이트했습니다.
            const cumulativeInflow = 54469000000; // $54,469 Million = $54.469 Billion
            const dailyInflow = -28600000;       // Farside 기준 최신 일일 유출입 예시 (-$28.6M)

            const formatLargeNumber = (num) => {
                if (Math.abs(num) >= 1.0e+9) return `$${(num / 1.0e+9).toFixed(2)}B`;
                if (Math.abs(num) >= 1.0e+6) return `$${(num / 1.0e+6).toFixed(2)}M`;
                return `$${num.toLocaleString()}`;
            };
            
            etfTotalElement.innerText = formatLargeNumber(cumulativeInflow);
            etfTotalElement.classList.toggle('up', cumulativeInflow >= 0);
            etfTotalElement.classList.toggle('down', cumulativeInflow < 0);
            
            const sign = dailyInflow >= 0 ? '+' : '';
            etfChangeElement.innerText = `${sign}${formatLargeNumber(dailyInflow)} (Daily)`;
            
            etfChangeElement.classList.toggle('up', dailyInflow >= 0);
            etfChangeElement.classList.toggle('down', dailyInflow < 0);
        }

        // 3. 현재 시간 표시 함수 (미국 동부 & 한국)
        function displayCurrentTime() {
            const now = new Date();
            const options = {
                year: 'numeric', month: '2-digit', day: '2-digit',
                hour: '2-digit', minute: '2-digit', second: '2-digit',
                hour12: true
            };
            const usEasternTime = now.toLocaleString('en-US', { ...options, timeZone: 'America/New_York' });
            const koreaTime = now.toLocaleString('ko-KR', { ...options, timeZone: 'Asia/Seoul' });
            timestampElement.innerHTML = `🇺🇸 ${usEasternTime} (US Eastern)<br>🇰🇷 ${koreaTime} (Korea)`;
        }

        // --- 초기 실행 및 주기적 업데이트 설정 ---
        
        // 페이지 로드 시 즉시 함수들을 호출
        fetchBtcPrice();
        displayEtfInflow();
        displayCurrentTime();

        // 1초마다 시간 업데이트
        setInterval(displayCurrentTime, 1000);
        
        // 30초마다 BTC 가격 업데이트
        setInterval(fetchBtcPrice, 30000);
    </script>
</body>
</html>